trigger:
  branches:
    include:
      - main
pr:
  - main

resources:
  repositories:
    - repository: stratus-templates
      type: git
      name: Cloud Excellence Team/stratus-templates
      ref: main

pool:
  vmImage: 'ubuntu-latest'

extends:
  template: templates/security/security-scans.yml@stratus-templates
  parameters:
    break: false
    stages:
      - stage: build_test
        displayName: Build and test

        jobs:
          - job: unit_test
            displayName: Unit test
            steps:
              - task: Npm@1
                displayName: Npm ci
                inputs:
                  command: 'ci'
              - task: Npm@1
                displayName: Npm run build
                inputs:
                  command: 'custom'
                  customCommand: run build
              - template: /templates/test/npm.yml@stratus-templates
                parameters:
                  nodeVersion: 18
